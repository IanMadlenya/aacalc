{% extends "base.html" %}

{% comment %}

AACalc - Asset Allocation Calculator
Copyright (C) 2009, 2011-2016 Gordon Irlam

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

{% endcomment %}

{% block title %}Asset allocation calculator{% endblock %}

{% block head %}
{% if mode == 'aa' %}
<meta name="description" content="Computes appropriate asset allocation, income annuities, and consumption using scientific principles. And explains how the recommendations were derived." /><!-- Keep content to less than 155 characters according to Wikipedia. -->
{% else %}
<meta name="description" content="Computes your retirement number using scientific principles. And explains how your number was derived." />
{% endif %}
<script type="text/javascript" src="/static/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    // Handle page reloads, button state may be remembered by browser but show/hide are not.
    $('.advanced_button:checked').closest('.simple_advanced').find('.advanced,.simple').toggle();
    $('.advanced_button').click(function() {
        $(this).closest('.simple_advanced').find('.advanced,.simple').toggle();
    });

    e = document.getElementById("results");
    if (e)
         e.scrollIntoView();
});
</script>
{% endblock %}

{% block content %}

{% if mode == 'aa' %}
<h1>Asset allocation calculator</h1>
{% else %}
<h1>Retirement Number Calculator</h1>
{% endif %}

<p>
<img style="float: right; margin-left: 10px;" width=400 height=200 src="/static/images/shutterstock_69970861.jpg" alt="golden egg">
</p>

{% if mode == 'aa' %}
This calculator computes asset allocations, income annuitization,
and consumption using scientific
principles. And it explains how the recommendations were derived.
{% else %}
This calculator computes the financial position you need to be in
for retirement. And it explains how your number was derived.
{% endif %}

<br />
<br />

This calculator does not include a questionnaire on risk tolerance
(your psychological ability to stomach investment losses). Instead it
primarily concerned with computing the appropriate strategy given your risk
aversion (preference for uniform consumption).

<br />
<br />

Several things set this calculator apart:

<ul>

<li> A balance sheet approach - asset allocation can't be performed in
isolation, but must be performed by taking into account the presence
and size of Social Security, Pensions, 401(k)'s, and income
annuities. See the <a href="{% url 'docs' 'faq' %}">FAQ</a> for more
details.</li>

{% if mode == 'aa' %}
<li> Future contributions - the impact of any possible future
contributions is handled by entering their expected annual amount,
growth rate, and volatility. </li>
{%endif %}

<li> A true risk free asset - liability matching bonds, that is
inflation indexed zero coupon bonds with a duration matching that of
anticipated retirement cash flows, not cash, are used as the true risk
free asset. Liability matching bonds might be hard to purchase, but a
TIPS ladder, or a TIPS bond fund of appropriate duration, is a close
substitute. </li>

<li> Income annuities - income annuities are a valuable tool in the
retirement toolbox. This calculator optionally recommends the
purchase of inflation indexed income annuities, be they single premium
immediate annuities or deferred income annuities. </li>

<li> Admit what we don't know - returns from the stock market are
intrinsically unknown. We generate a range of results for different plausible
scenarios. </li>

<li> Cross validated - sample Merton's method recommendations produced
by this calculator have been
<a href="{% url 'docs' 'validation' %}">cross validated</a> with a
second asset allocator that uses stochastic dynamic programming. </li>

<li> Open source - available under a GNU Affero license on
GitHub: <a href="https://github.com/gordoni/aacalc">https://github.com/gordoni/aacalc</a> </li>

</ul>

<div style="clear: both;"></div>

<form  method="post">
{% csrf_token %}

{% if errors_present %}
<div class="errorlist">
Please correct the errors in red below:
</div>
{{ alloc_form.non_field_errors }}
{% endif %}

<h2>Longevity</h2>

<div class="indent">

Sex: {{ alloc_form.sex }}
Age: {{ alloc_form.age }}
{{ alloc_form.sex.errors }}
{{ alloc_form.age.errors }}
<br />
Spouse/partner: {{ alloc_form.sex2 }}
Age: {{ alloc_form.age2 }}
{{ alloc_form.sex2.errors }}
{{ alloc_form.age2.errors }}

</div>

<h2>Financial position</h2>

<div class="indent">

Existing defined benefits:

<br />
<br />

<div class="indent">

{{ alloc_form.db.management_form }}
<table class="table-lined center">
<tr>
<td> </td>
<td> Owner <br /> self/spouse </td>
<td> Starting age </td>
<td> Annual amount </td>
<td> Inflation indexed </td>
<td> Period certain </td>
<td> Death benefit <br /> Contingent/survivor payout </td>
</tr>
{% for db in alloc_form.db %}
<tr>
<td>
{{ db.social_security }}
{% if db.social_security.value == True %}
Social Security
{% else %}
{% if db.social_security.value == 'True' %}
{% comment %} Django goofyness on a bound form {% endcomment %}
Social Security
{% else %}
{{ db.description }}
{% endif %}
{% endif %}
</td>
<td> {{ db.who }} </td>
<td> {{ db.age }} </td>
<td> {{ db.amount }} </td>
<td> {{ db.inflation_indexed }} </td>
<td> {{ db.period_certain }} </td>
<td> {{ db.joint_type }} {{ db.joint_payout_pct }}% </td>
</tr>
<tr>
<td colspan=6 class="left">
{{ db.social_secuity.errors }}
{% if db.social_security.value == True %}
{% else %}
{% if db.social_security.value == 'True' %}
{% else %}
{{ db.description.errors }}
{% endif %}
{% endif %}
{{ db.who.errors }}
{{ db.age.errors }}
{{ db.amount.errors }}
{{ db.inflation_indexed.errors }}
{{ db.period_certain.errors }}
{{ db.joint_type.errors }}
{{ db.joint_payout_pct.errors }}
{{ db.non_field_errors }}
</td>
</tr>
{% endfor %}
<tr>
<td colspan=7 class="small left">
Starting age is that of the owner. Payouts last at least as long as the owner's life.
Period certain: the number of years for which payments are guaranteed, even if the owner dies.
Contingent: payout reduced on death of either party.
Survivor: payout reduced only on death of the owner.
</td>
</tr>
</table>

</div>

{% if mode == 'aa' %}

<br />

Existing defined contribution savings:

<br />
<br />

<div class="indent">

Pre-tax traditional IRAs, 401(k)'s, 403(b)'s, and 457's size: {{ alloc_form.p_traditional_iras }}
Tax rate: {{ alloc_form.tax_rate_pct }}%
{{ alloc_form.p_traditional_iras.errors }}
{{ alloc_form.tax_rate_pct.errors }}
<br />
Post-tax Roth IRAs, 401(k)'s, and 403(b)'s size: {{ alloc_form.p_roth_iras }}
{{ alloc_form.p_roth_iras.errors }}
<br />
Taxable retirement savings size: {{ alloc_form.p }}
{{ alloc_form.p.errors }}
<div class="small">
You may want to reduce this last value slightly to reflect the effects
of taxation.  Variable annuities are not recommended as an investment
vehicle, but principal should be handled similarly to post-tax
investments and earnings should be handled similarly to pre-tax
investments.
</div>
<br />
Pre-retirement annual contribution amount (irrelevant if retired):
{{ alloc_form.contribution }}
{{ alloc_form.contribution.errors }}
<br />
Growth rate: {{ alloc_form.contribution_growth_pct }}%
Annual volatility of future payments: {{ alloc_form.contribution_vol_pct }}%
{{ alloc_form.contribution_growth_pct.errors }}
{{ alloc_form.contribution_vol_pct.errors }}
<br />
Correlation with equity returns: {{ alloc_form.equity_contribution_corr_pct }}%
Correlation with bond returns: {{ alloc_form.bonds_contribution_corr_pct }}%
{{ alloc_form.equity_contribution_corr_pct.errors }}
{{ alloc_form.bonds_contribution_corr_pct.errors }}
<div class="small">
Contribution amount is assumed to be post tax, and should consist only
of new money contributed to your retirement savings, not the payout from any existing pre-retirement
defined benefits. A growth rate of 7% represents a doubling of real
contributions every 10 years.  Remember to take into account life
events such as promotions, paying off a mortgage, or children leaving
home in estimating the contribution growth rate.
</div>

</div>

{% endif %}

</div>

<h2>Financial goals</h2>

<div class="indent">

Age of primary person at retirement: {{ alloc_form.retirement_age }}
{{ alloc_form.retirement_age.errors }}
<br />
Relative income required when one party deceased: {{ alloc_form.joint_income_pct }}%
{{ alloc_form.joint_income_pct.errors }}
<br />
{% if mode == 'aa' %}
Annual consumption at which you have "won the game": {{ alloc_form.desired_income }}
{{ alloc_form.desired_income.errors }}
<div class="small">
Winning the game means having consumption that meets your required and
desired expenses.  Assets required to support consumption beyond this
level will be allocated to stocks.
</div>
{% else %}
Annual desired consumption level: {{ alloc_form.desired_income }}
{% endif %}
<br />
Use liability matching bonds: {{ alloc_form.use_lm_bonds }}
{{ alloc_form.use_lm_bonds.errors }}
<div class="small">
Inflation-indexed liability matching bonds are a valuable retirement
planning tool. However the short term volatility of long duration
liability matching bonds may make them unattractive to investors with
a low risk tolerance. If liability matching bonds are not used we
naively replace them with regular bonds.
</div>
<br />
Permit recommendation of income annuities: {{ alloc_form.purchase_income_annuity }}
{{ alloc_form.purchase_income_anuity.errors }}
<div class="small">
Income annuities only make sense if you are in reasonable health.
</div>
<br />
We do not support the ability to leave a specific bequest amount.

</div>

<h2>Market parameters</h2>

<div class="indent">

You can probably leave the parameters in this section alone.

<br />
<br />

Estimated equity arithmetic real return: {{ alloc_form.equity_ret_pct }}%
Volatility: {{ alloc_form.equity_vol_pct }}%
{{ alloc_form.equity_ret_pct.errors }}
{{ alloc_form.equity_vol_pct.errors }}
<div class="small">
U.S. market average values for 1927-2014 are 8.7% and 19.6%.
World market average values for 1900-2000 are 7.2% and 17.0%.
Going
forward <a href="http://www.advisorperspectives.com/newsletters12/Jeremy_Siegel_Rob_Arnott_and_Other_Experts_Forecast_Equity_Returns.php">many
experts</a> predict lower U.S. stock market returns.
</div>
<br />
Estimated regular bonds arithmetic real return: {{ alloc_form.bonds_ret_pct }}%
Volatility: {{ alloc_form.bonds_vol_short_pct }}%
Long-term volatility: {{ alloc_form.bonds_vol_pct }}%
{{ alloc_form.bonds_ret_pct.errors }}
{{ alloc_form.bonds_vol_pct.errors }}
{{ alloc_form.bonds_vol_short_pct.errors }}
<div class="small">
Estimated U.S. market average values for 1927-2014 are 3.2% and
8.7%. However we are presently in a low rate environment. At the end of
2015, 10 year constant maturity Treasuries were projected to earn
2.3%, which is 0.1% above the Survey of Professional forecasters 10
year inflation rate of 2.2%. We estimate the premium of an average
bond portfolio over 10 year constant maturity Treasuries is 0.6%,
making a total return of 0.7%.  For the long term investor short-term
volatility in the price of bonds doesn't matter.  What matters is the
volatility of nominal prices. The volatility of the CPI over the
1927-2014 was 4.1%.
<br />
<br />
<div class="bold">Using the default parameters no regular bonds will
typically be recommended because they currently have a lower expected
return than zero long-term volatility inflation indexed liability matching
bonds.</div>
</div>
<br />
Correlation of equity returns with bonds: {{ alloc_form.equity_bonds_corr_pct }}%
{{ alloc_form.equity_bonds_corr_pct.errors }}
<div class="small">
Estimated U.S. market average value for 1927-2014 is 7.3%.
</div>
<br />
Real volatility of 10 year inflation-indexed zero coupon bonds:
{{ alloc_form.real_vol_10yr_pct }}%
{{ alloc_form.real_vol_10yr_pct.errors }}
<br />
Correlation with regular bonds: {{ alloc_form.bonds_lm_bonds_corr_short_pct }}%
{{ alloc_form.bonds_lm_bonds_corr_short_pct.errors }}
<div class="small">
Synthetic historical values for 1972-2014 for coupon bonds are 4.9%
and 28.9%. Zero coupon bonds will be similar.
</div>
<br />
Standard error of estimate of equity real return: {{ alloc_form.equity_se_pct }}%
{{ alloc_form.equity_se_pct.errors }}
<div class="small">
U.S. market average value for 1927-2014 is 2.1%.
World market average value for 1900-2000 is 1.7%.
<!--
U.S. market average value for 1900-2000 is 2.0% stocks relative to nominal long bonds.
World market average value for 1900-2000 is 1.4% stocks relative to nominal long bonds.
-->
</div>
Also report results forming a {{ alloc_form.confidence_pct }}%
confidence interval for the equity return.
{{ alloc_form.confidence.errors }}
<br />
<br />
Equity and regular bond management fee: {{ alloc_form.expense_pct }}%
{{ alloc_form.expense_pct.errors }}
<div class="small">
A value around 0.1% is typical for a low cost provider such
as <a href="http://www.vanguard.com/">Vanguard</a>.
</div>

<br />

Calculation date: {{ alloc_form.date }}
<div class="small">
Determines interest rate yield curve.
</div>
{{ alloc_form.date.errors }}

</div>

<h2>Well being</h2>

<div class="indent">

Coefficient of relative risk aversion, &gamma;: {{ alloc_form.gamma }}
{{ alloc_form.gamma.errors }}
<div class="small">
This determines how risk averse you are. A value such as 1 represents
a low degree of risk aversion and favors stocks. A value such as 5
represents a high degree of risk aversion and favors bonds. Risk
aversion is not the same as risk tolerance.  Risk tolerance is about
how psychologically comfortable you are with losses to your investment
assets. Risk aversion is about how you feel about a change in your
annual consumption. Economists are divided on an appropriate value for
&gamma;. Many think it is in the range 1 to 3. Others consider a value
of 10 or even higher reasonable. Marginal utility of consumption,
U'(C) = C<sup>-&gamma;</sup>.
<br />
<br />
This is a difficult concept. We present multiple tables to help you
get this important parameter right.
<br />
<br />
<table class="table-lined center">
<tr>
<td colspan=6> As &gamma; increases the desirability of risk taking decreases. </td>
</tr>
<tr>
<td> &gamma; </td>
<td> 1 </td>
<td> 2 </td>
<td> 3 </td>
<td> 4 </td>
<td> 5 </td>
</tr>
<tr>
<td class="left"> Indifference to a 50/50 chance of consuming either 100% of C or 200%
<br /> of C versus consuming the guaranteed fixed percentage of C shown </td>
<td> 141% </td>
<td> 133% </td>
<td> 126% </td>
<td> 121% </td>
<td> 117% </td>
</tr>
</table>
<br />
<table class="table-lined center">
<tr>
<td colspan=6> The value of an additional dollar declines as you consume more. </td>
</tr>
<tr>
<td> &gamma; </td>
<td> 1 </td>
<td> 2 </td>
<td> 3 </td>
<td> 4 </td>
<td> 5 </td>
</tr>
<tr>
<td class="left"> Value of an additional dollar when consuming 110% of C compared
<br> to the value of an additional dollar when consuming 100% of C </td>
<td> 91% </td>
<td> 83% </td>
<td> 75% </td>
<td> 68% </td>
<td> 62% </td>
</tr>
</table>
<br />
<table class="table-lined center">
<tr>
<td colspan=6> The value of an additional dollar declines rapidly for high consumption levels. </td>
</tr>
<tr>
<td> &gamma; </td>
<td> 1 </td>
<td> 2 </td>
<td> 3 </td>
<td> 4 </td>
<td> 5 </td>
</tr>
<tr>
<td class="left"> Value of an additional dollar when consuming 200% of C compared
<br> to the value of an additional dollar when consuming 100% of C </td>
<td> 50% </td>
<td> 25% </td>
<td> 13% </td>
<td> 6% </td>
<td> 3% </td>
</tr>
</table>
</div>

<br />

Risk tolerance: 10% annual chance of experiencing real investment
portfolio losses of {{ alloc_form.risk_tolerance_pct }}% or more.
{{ alloc_form.risk_tolerance_pct.errors }}
<div class="small">
Risk tolerance is concerned with the ability to psychologically handle
losses to your investment portfolio, and not pull out of the market in
the event of a downturn.  Risk tolerance differs from risk aversion by
only looking at investment assets rather than the total portfolio
including defined benefits. Setting it to a low or intermediate value
provides for peace of mind but will reduce your expected
consumption. In an ideal world it might be set as high as possible so
that risk aversion, which looks at the total portfolio, can take over
in determining the appropriate asset allocation. For the default
market parameters a value of 15% or higher effectively imposes no
constraints. Setting it to a value of 10% or less is only possible if
you also alter the default market parameters to be indicative of
short-term bonds.
</div>

</div>

<br />

<div class="center">
<input class="button" type="submit" value="Submit" />
<!--
{% if mode == 'number' %}
<div class="small">
takes 5 seconds
</div>
{% endif %}
-->
</div>

{% if results and not errors_present %}

<div id="results">

<br />

<div class="simple_advanced">

<img src="{{ results.dirurl }}/alloc.png" alt="allocation">
<br />
<img style="float: right; margin-left: 10px;" src="{{ results.dirurl }}/aa.png" alt="asset allocation">

<br />

{% if mode == 'number' %}

For your desired consumption level you need to have a total of
{{ results.calc.0.npv_display.nv_taxable }} today excluding defined benefits.
An {{ alloc_form.cleaned_data.confidence_pct }}% confidence interval
on this recommendation is {{ results.calc.2.npv_display.nv_taxable }} to
{{ results.calc.1.npv_display.nv_taxable }}.
<div class="small">
The amount you would require in the future will be larger; if you had
this amount today it would be invested and growing. Uncertainty in
this amount is the result of inherent uncertainty in the expected
return of stocks compounded over time.
</div>

<br />

{% endif %}

{% if results.calc.0.annuitize_plan %}

We recommend purchasing an income annuity of {{ results.calc.0.purchase_income_annuity }}.
This is estimated to increase your annual consumption by {{ results.calc.0.annuitize_gain }}
versus never doing so.
<div class="small">
We roughly estimate the cost of delaying this purchase by one year as
{{ results.calc.0.annuitize_delay_cost }} in aggregate consumption
over your lifetime.  We recommend the income annuity, be it a single
premium immediate annuity or a deferred income annuity, be inflation
indexed. Do not purchase a variable annuity. The consumption
recommendations made below factor
in the purchase of this income annuity.
</div>

<br />

{% elif alloc_form.cleaned_data.purchase_income_annuity %}

We do not recommend you purchase an income annuity at the present
time.

<br />
<br />

{% endif %}

We recommend adopting a
<!-- healthcheck_aa --> {{ results.calc.0.aa_equity_pct }}/{{ results.calc.0.aa_bonds_pct }}
stock/bond asset allocation.
<div class="small">
Asset allocation is between stocks and regular bonds plus liability
matching bonds. For most scenarios a stock heavy asset allocation is
appropriate because defined benefits are in many ways similar to
bonds.
<br />
The recommendation does not take into account your risk tolerance.
You might want to adopt a lower asset allocation if you feel you
can not psychologically handle the volatility associated with the
recommended asset allocation.
<br />
Stock holdings should be diversified. At least 20 different
stocks. Preferably many more. Such diversification can be obtained
using a low cost index fund.
Regular bond holdings are nominal and should also be diversified.
Again an index fund suffices.
Liability matching bonds should be inflation indexed and have a
duration of about {{ results.calc.0.lm_bonds_duration }} years.
</div>

<br />

With about {{ alloc_form.cleaned_data.confidence_pct }}% confidence
the proportion of stocks recommended is in the range
{{ results.calc.1.aa_equity_pct }}% to {{ results.calc.2.aa_equity_pct }}%.
<div class="small">
This range can be very large as a result of intrinsic uncertainty in
the expected premium of equities over bonds given only about 100 years
of historical data and a high volatility. For more details see
<a href="http://ssrn.com/abstract=2675390">Asset Allocation Confidence
Intervals in Retirement</a>.
<br />
For confidence intervals in excess of about 95% the computed
lower bound will be lower than it should be. This is because demand
side effects mean we can be confident the return for equities exceeds
that of bonds.
</div>

<br />

{% if mode == 'aa' %}

The amount you should consume during retirement varies from year to
year. Currently it is recommended
you should consume around <!-- healthcheck_consume --> {{ results.calc.0.consume }}
per year in retirement.
An {{ alloc_form.cleaned_data.confidence_pct }}% confidence interval
on this recommendation is {{ results.calc.1.consume }} to
{{ results.calc.2.consume }}.

<br />
<br />

{% endif %}

The annual volatility of your investment portfolio is estimated to be
{{ results.calc.0.investments_vol_pct }}%.  The annual volatility of
your total portfolio, and hence your consumption, is estimated to be
{{ results.calc.0.total_vol_pct }}%.

<br />
<br />

<div style="clear: both;"></div>

<div class="advanced_controller">
Show calculations: {{ alloc_form.advanced_calculations }}
{{ alloc_form.advanced_calculations.errors }}
</div>

<div class="advanced">

<h2>Common calculations</h2>

<div class="indent">

Yield curve date: {{ results.yield_curve_date }}.

<br />
<br />

Net present value table:

<table class="table-lined center">
<tr>
<td> </td>
<td> Owner </td>
<td> Net present value
<div class="small">
real interest rate adjusted
</div>
</td>
</tr>
{% for db in results.db %}
<tr>
<td class="left"> {{ db.present.description }} </td>
<td> {{ db.present.who }} </td>
<td class="right"> {{ db.present.nv }} </td>
</tr>
{% endfor %}
<tr>
<td class="left"> Total defined benefits </td>
<th colspan=2 class="right"> {{ results.present.nv_db }} </th>
</tr>
{% if mode == 'aa' %}
<tr>
<td class="left"> Traditional </td>
<td colspan=2 class="right"> {{ results.present.nv_traditional }} </td>
</tr>
<tr>
<td class="left"> Roth </td>
<td colspan=2 class="right"> {{ results.present.nv_roth }} </td>
</tr>
<tr>
<td class="left"> Taxable </td>
<td colspan=2 class="right"> {{ results.present.nv_taxable }} </td>
</tr>
{% endif %}
<tr>
<td class="left"> Total investments </td>
<th colspan=2 class="right"> {{ results.present.nv_investments }} </th>
</tr>
{% if mode == 'aa' %}
<tr>
<td class="left"> Future contributions </td>
<th colspan=2 class="right"> {{ results.present.nv_contributions }} </th>
</tr>
{% endif %}
<tr>
<td class="left"> Total net present value </td>
<th colspan=2 class="right"> {{ results.present.nv }} </th>
</tr>
<tr>
<tr>
<td colspan=4 class="left small"> Computed from mortality table and real yield curve. </td>
</tr>
</table>

<br />

Years until retirement: {{ results.pre_retirement_years }}
<br />
Retirement additional life expectancy: {{ results.calc.0.retirement_life_expectancy }} years
<br />
Liability matching bonds expected arithmetic real return: {{ results.calc.0.lm_bonds_ret_pct }}%
<br />
Macaulay duration: {{ results.calc.0.lm_bonds_duration }} years
<div class="small">
Computed from mortality table and real yield curve assuming level
consumption requirements except when one party is deceased.
</div>

</div>

{% for calc in results.calc %}

<h2>{{ calc.description }}</h2>

<div class="indent">

Arithmetic real return on equities: {{ calc.equity_am_pct }}% Regular bonds: {{ calc.bonds_am_pct }}%
<br />
Geometric real return on equities: {{ calc.equity_gm_pct }}% Regular bonds: {{ calc.bonds_gm_pct }}%

<br />
<br />

{% if mode == 'number' %}

We tried a number of different portfolio sizes. Here are the results
for the portfolio size that gives close to the desired level of consumption:

<br />
<br />

Total portfolio value excluding defined benefits: {{ calc.npv_display.nv_investments }}

<br />

{% endif %}

Total net present value: {{ calc.npv_display.nv }}

<br />
<br />

{% if mode == 'aa' %}

By trial and error we determined that we should assume a future
contributions discount rate relative to the real interest rate, d =
{{ calc.future_growth_try_pct }}%

<br />
<br />

Using d as the rate of return for discounted future contributions
gives the following recommended asset allocation:

<table class="table-lined center">
{% for w in calc.w %}
<tr>
<td class="left"> {{ w.name }} </td>
<td class="right"> {{ w.alloc }}% </td>
</tr>
{% endfor %}
<tr>
<td colspan=2 class="small">
Computed assuming liability matching bonds and defined benefits are risk free using the matrix version of <a href="https://en.wikipedia.org/wiki/Merton's_portfolio_problem">Merton's formula</a>.
</td>
</tr>
</table>

<br />

Don't be alarmed by negative values or values greater than 100% in the table above.
We will eliminate them later.

<br />
<br />

Discounted value of future contributions: {{ calc.discounted_contrib }}

<br />

Discounted future contributions as a proportion of adjusted total NPV: {{ calc.wc_discounted }}%

<br />
<br />

The percentage holdings of discounted future contributions matches the
recommended percentage shown in the table above. This is as it should
be, since we can neither buy nor sell future contributions.

<br />
<br />

Adjusting the recommended asset allocation for future contributions
when they are discounted at the real interest rate gives:

{% else %}

We calculated the following asset allocations:

{% endif %}

<table class="table-lined center">
{% for w in calc.w_prime %}
<tr>
<td class="left"> {{ w.name }} </td>
<td class="right"> {{ w.alloc }}% </td>
</tr>
{% endfor %}
{% if mode == 'number' %}
<tr>
<td colspan=2 class="small">
Computed assuming liability matching bonds and defined benefits are
risk free using the matrix version
of <a href="https://en.wikipedia.org/wiki/Merton's_portfolio_problem">Merton's formula</a>.
</td>
{% endif %}
</table>

{% if calc.annuitize_plan %}

<br />

Recommended annuitization ratios:
Stocks {{ calc.annuitize_equity_pct }}%. Regular bonds {{ calc.annuitize_bonds_pct }}%. Liability matching bonds {{ calc.annuitize_lm_bonds_pct }}%.
<div class="small">
The advantages of annuitizing the stock portion of a portfolio at
advanced ages are well understood. What isn't well known is that there
are advantages to annuitizing the fixed income portion of a portfolio
at earlier ages. For details see
<a href="{% url 'docs' 'when_to_annuitize' %}">When to Annuitize</a>.
The ratios above are the proportion of each portfolio
holding type that we recommend be annuitized. In
the US as of 2016 the Money's Worth Ratios for deferred income
annuities were substantially worse than those of single premium
immediate annuities, but it might seem odd to purchase a SPIA
pre-retirement.
</div>

{% endif %}

<br />

Adjusting for any existing defined benefits, any income annuity
purchases, the substitution of regular bonds for liability matching
bonds, and the possibility of having won the game, produces the
following recommendations.

<table class="table-lined center">
<tr>
<td> </td>
<td> Recommended allocation </td>
<td> Expected return
<div class="small">
Inflation adjusted.
</div>
</td>
<td> Real volatility </td>
<td> Liability matching volatility </td>
</tr>
{% if mode == 'aa' %}
<tr>
<td class="left"> Future contributions </td>
<td class="right"> {{ calc.alloc_contributions_pct }}% </td>
<td class="right"> {{ results.present.ret_contributions }}% </td>
<td class="right"> - </td>
<td class="right"> {{ alloc_form.cleaned_data.contribution_vol_pct | floatformat:1 }}% </td>
</tr>
{% endif %}
<tr>
<td class="left"> Stocks </td>
<td class="right"> {{ calc.alloc_equity_pct }}% </td>
<td class="right"> {{ calc.equity_ret_pct }}% </td>
<td class="right"> {{ alloc_form.cleaned_data.equity_vol_pct | floatformat:1 }}% </td>
<td class="right"> {{ alloc_form.cleaned_data.equity_vol_pct | floatformat:1 }}% </td>
</tr>
<tr>
<td class="left"> Regular bonds </td>
<td class="right"> {{ calc.alloc_bonds_pct }}% </td>
<td class="right"> {{ calc.bonds_ret_pct }}% </td>
<td class="right"> {{ alloc_form.cleaned_data.bonds_vol_short_pct | floatformat:1 }}% </td>
<td class="right"> {{ alloc_form.cleaned_data.bonds_vol_pct | floatformat:1 }}% </td>
</tr>
<tr>
<td class="left"> Liability matching bonds </td>
<td class="right"> {{ calc.alloc_lm_bonds_pct }}% </td>
<td class="right"> {{ calc.lm_bonds_ret_pct }}% </td>
<td class="right"> {{ calc.lm_bonds_vol_short_pct }}% </td>
<td class="right"> 0.0% </td>
</tr>
<tr>
<td class="left"> Existing defined benefits </td>
<td class="right"> {{ calc.alloc_existing_db_pct }}% </td>
<td class="right"> {{ calc.lm_bonds_ret_pct }}% </td>
<td class="right"> - </td>
<td class="right"> 0.0% </td>
</tr>
<tr>
<td class="left"> New income annuities </td>
<td class="right"> {{ calc.alloc_new_db_pct }}% </td>
<td class="right"> {{ calc.lm_bonds_ret_pct }}% </td>
<td class="right"> - </td>
<td class="right"> 0.0% </td>
</tr>
<tr>
<th class="left" rowspan=2> Investments </th>
<th class="right" rowspan=2> {{ calc.alloc_investments_pct }}% </th>
<th class="right"> arithmetic {{ calc.investments_ret_pct }}% </th>
<th class="right" rowspan=2> {{ calc.investments_vol_pct }}% </th>
<td class="right" rowspan=2> - </td>
</tr>
<tr>
<th class="right"> geometric {{ calc.investments_geometric_ret_pct }}% </th>
</tr>
<tr>
<th class="left" rowspan=2> Total </th>
<th class="right" rowspan=2> 100% </th>
<th class="right"> arithmetic {{ calc.total_ret_pct }}% </th>
<td class="right" rowspan=2> - </td>
<th class="right" rowspan=2> {{ calc.total_vol_pct }}% </th>
</tr>
<tr>
<th class="right"> geometric {{ calc.total_geometric_ret_pct }}% </th>
</tr>
</table>

<div class="small">
We assume regular bonds are closest to liability matching bonds and
defined benefits, and reduce the former to make up for any need to
increase the latter.
<br />
We assume existing defined benefits are predominately
inflation-indexed.
</div>

<br />

{{ calc.loss_pctl_pct }}th percentile annual real investment portfolio decline: {{ calc.investments_loss_pct }}%
<br />
{{ calc.loss_pctl_pct }}th percentile annual total portfolio decline: {{ calc.total_loss_pct }}%
<div class="small">
Computed assuming lognormally distributed returns. In reality returns
are fat-tailed.  This should not greatly effect the results for a
percentile value like the 10th.
</div>

<br />

Recommended annual retirement consumption amount without annuitization: {{ calc.consume_unannuitize }}
{% if alloc_form.cleaned_data.purchase_income_annuity %}
<br/>
Recommended annual retirement consumption amount with annuitization: {{ calc.consume_annuitize }}
{% endif %}
<div class="small">
Estimate based on rules of thumb that break down at advanced ages.
</div>

{% if alloc_form.cleaned_data.purchase_income_annuity %}

<br />

Potential income annuity purchase amount: {{ calc.purchase_income_annuity }}

<br />

Estimated lifetime cost of delaying purchase of income annuity by one year: {{ calc.annuitize_delay_cost }}

<br />

{% endif %}

<br />

Investment stock/bond asset allocation: {{ calc.aa_equity_pct }}/{{ calc.aa_bonds_pct }}

</div>

{% endfor %}

</div>
</div>
</div>

<!-- Blank space so calculations start to become visible when click show calculations. -->
<br />
<br />

{% endif %}

</form>

{% endblock %}
